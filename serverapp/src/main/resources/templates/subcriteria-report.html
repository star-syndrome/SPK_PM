<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8" />
		<title>Laporan Subkriteria</title>
		<style>
			html,
			body {
				font-family: "Arial", sans-serif;
				margin: 0;
				padding: 0;
				font-size: 12px;
			}

			.kop-surat {
				text-align: center;
				border-bottom: 2px solid black;
				padding-bottom: 2px;
				margin-bottom: 10px;
			}

			.kop-surat img {
				width: 90px;
				height: 80px;
				float: left;
			}

			.kop-surat .kop-text {
				font-size: 14px;
			}

			.kop-surat h1 {
				margin: 0;
				font-size: 25px;
			}

			.kop-surat p {
				margin: 1px 0;
				font-size: 10px;
			}

			.clear {
				clear: both;
			}

			h2.judul {
				text-align: center;
				text-decoration: underline;
				margin-top: 30px;
				margin-bottom: 20px;
				font-size: 18px;
			}

			h3 {
				margin-top: 30px;
				margin-bottom: 10px;
			}

			table {
				width: 100%;
				border-collapse: collapse;
				margin-bottom: 20px;
			}

			th,
			td {
				border: 1px solid black;
				padding: 6px 10px;
				text-align: center;
				font-size: 12px;
			}

			th {
				background-color: #f0f0f0;
			}

			tr:nth-child(even) td {
				background-color: #f9f9f9;
			}

			.kriteria-section {
				page-break-inside: avoid;
			}

			.ttd {
				margin-top: 60px;
				width: 100%;
				page-break-inside: avoid;
				break-inside: avoid;
			}

			.ttd td {
				border: none;
				vertical-align: top;
			}

			.ttd .kanan {
				text-align: center;
				width: 40%;
			}

			.ttd .space {
				height: 80px;
			}
		</style>
	</head>
	<body>
		<!-- Kop Surat -->
		<div class="kop-surat">
			<img
				th:src="'data:image/png;base64,' + ${logoBase64}"
				alt="Logo Posyandu" />
			<div class="kop-text">
				<h1>Posyandu Lansia Melati</h1>
				<p>Jl. Kramat Lontar Gang 1, RT 017/RW 001</p>
				<p>Kelurahan Paseban, Kecamatan Senen, Jakarta Pusat</p>
				<p>Email: posyandulansiamelati@gmail.com | Telp: 0812-3456-7890</p>
			</div>
			<div class="clear"></div>
		</div>

		<!-- Judul Laporan -->
		<h2 class="judul">Laporan Data Subkriteria</h2>

		<!-- Semua kriteria kecuali terakhir -->
		<div th:each="criteriaGroup, stat : ${groupedSubcriteria}">
			<div th:if="${!stat.last}" class="kriteria-section">
				<h3
					th:text="'Kriteria: ' + ${criteriaGroup.key.name} + ' (' + ${#numbers.formatDecimal(criteriaGroup.key.weight * 100, 1, 2)} + '%)'"></h3>
				<table>
					<thead>
						<tr>
							<th>No</th>
							<th>Deskripsi Subkriteria</th>
							<th>Kode</th>
							<th>Nilai Target</th>
							<th>Tipe</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="sub, iterStat : ${criteriaGroup.value}">
							<td th:text="${iterStat.count}"></td>
							<td th:text="${sub.description}"></td>
							<td th:text="${sub.code}"></td>
							<td th:text="${#numbers.formatDecimal(sub.target, 1, 2)}"></td>
							<td th:text="${sub.type}"></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- Kriteria terakhir + tanda tangan di halaman baru -->
		<div th:each="criteriaGroup, stat : ${groupedSubcriteria}">
			<div th:if="${stat.last}" style="page-break-before: always">
				<div class="kriteria-section">
					<h3
						th:text="'Kriteria: ' + ${criteriaGroup.key.name} + ' (' + ${#numbers.formatDecimal(criteriaGroup.key.weight * 100, 1, 2)} + '%)'"></h3>
					<table>
						<thead>
							<tr>
								<th>No</th>
								<th>Deskripsi Subkriteria</th>
								<th>Kode</th>
								<th>Nilai Target</th>
								<th>Tipe</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="sub, iterStat : ${criteriaGroup.value}">
								<td th:text="${iterStat.count}"></td>
								<td th:text="${sub.description}"></td>
								<td th:text="${sub.code}"></td>
								<td th:text="${#numbers.formatDecimal(sub.target, 1, 2)}"></td>
								<td th:text="${sub.type}"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<!-- Tanda Tangan -->
		<div style="page-break-inside: avoid; break-inside: avoid">
			<table class="ttd">
				<tr>
					<td></td>
					<td class="kanan">
						<p>
							Jakarta,
							<span th:text="${tanggalSekarang}"></span>
						</p>
						<p>Ketua Posyandu Lansia Melati</p>
						<div class="space"></div>
						<p><strong>Yetty Nuryati, S.Pd.</strong></p>
					</td>
				</tr>
			</table>
		</div>
	</body>
</html>
